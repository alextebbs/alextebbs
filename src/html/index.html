<!DOCTYPE html>
<html>
  <head>
    @include('head.html')
  </head>
  <body data-current-theme="default" class="first-time theme-select-is-active">
    @include('header.html')
    @include('about-this-design.html')

    <div id='content'></div>

    <script id="home-template" type="text/x-template">
      @include('home.html')
    </script>

    <script id="about-template" type="text/x-template">
      @include('about.html')
    </script>

    <script id="portfolio-template" type="text/x-template">
      @include('portfolio.html')
    </script>

    <script id="resume-template" type="text/x-template">
      @include('resume.html')
    </script>

    <div class='change-theme'>
      <a href="javascript:;" class='trigger-theme-select'></a>
    </div>

    <script src="/js/scripts.js"></script>

    <script>
      page.base('');
      page('*', showActiveLink);
      page('/', showHome);
      page('/about', showAbout);
      page('/portfolio', showPortfolio);
      page('/resume', showResume);
      page('*', notfound);
      page({hashbang:true});

      function showActiveLink(ctx, next) {
        deactiveate();
        a(ctx.path).classList.add('is-active');

        var currentTheme = $('body').attr('data-current-theme');

        if (currentTheme == 'flat') {
          if (ctx.init) {
            next();
          } else {
            content.classList.add('is-transitioning-out');
            setTimeout(function(){
              content.classList.remove('is-transitioning-out');
              content.classList.add('is-transitioning-in');
              next();
              setTimeout(function(){
                content.classList.remove('is-transitioning-in');
              }, 150);
            }, 150);
          }
        } else {
          next();
        }
      }

      function showHome(ctx) {
        // !ctx.init tells render() not to
        // add the .hide class so that the
        // transition animation is ignored
        // for the initial page
        render(template('home'), !ctx.init);
      }

      function showAbout(ctx) {
        render(template('about'), !ctx.init);
        initMasonry();
      }

      function showPortfolio(ctx) {
        render(template('portfolio'), !ctx.init);
      }

      function showResume(ctx) {
        render(template('resume'), !ctx.init);
      }

      function notfound(ctx) {
        render(template('not-found'), !ctx.init);
      }

      function render(html, hide) {
        var el = document.getElementById('content');
        // if (hide) {
          // el.classList.add('hide');
          // setTimeout(function(){
            // el.innerHTML = html;
            // el.classList.remove('hide');
          // }, 0);
        // } else {
          el.innerHTML = html;
        // }
      }

      function deactiveate() {
        var el = document.querySelector('.main-navigation .is-active')
        if (el) el.classList.remove('is-active');
      }

      function a(href) {
        return document.querySelector('[href="' + href + '"]');
      }

      function template(name) {
        return document
          .getElementById(name + '-template')
          .innerHTML;
      }

      function initMasonry() {
        var currentTheme = $('body').attr('data-current-theme');

        if (currentTheme == 'flat') {
          setTimeout(function() {
            var grid = document.querySelector('.tools');
            var msnry = new Masonry( grid, {
              itemSelector: '.tool',
              columnWidth: '.tool'
            });
          }, 50);
        };
      }
    </script>
  </body>
</html>
